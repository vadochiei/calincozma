"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("focus-options-polyfill");var e=require("react"),t=require("react-dom"),n=require("tslib");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=o(e),i=function(t){var n,o=e.useRef(t);o.current=t,n=function(){return function(){return o.current()}},e.useEffect(n,[])},a=function(t,n){void 0===t&&(t=1/0),void 0===n&&(n=1/0);var o="undefined"!=typeof window,r=function(t){var n=e.useRef(0),o=e.useState(t),r=o[0],a=o[1],l=e.useCallback((function(e){cancelAnimationFrame(n.current),n.current=requestAnimationFrame((function(){a(e)}))}),[]);return i((function(){cancelAnimationFrame(n.current)})),[r,l]}({width:o?window.innerWidth:t,height:o?window.innerHeight:n}),a=r[0],l=r[1];return e.useEffect((function(){if(o){var e=function(){l({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}}),[o,l]),a},l=function(e){return"".concat(e,"ms")},u=function(e){var t=e.height,o=e.innerHeight,r=e.innerWidth,i=e.isLoaded,a=e.isUnloading,u=e.left,d=e.originalTransform,c=e.top,f=e.transitionDuration,s=e.width,v=e.zoomMargin,m=l(f);if(!i||a){var g=n.__spreadArray(["scale(1)","translate(0, 0)"],d?[d]:[],!0).join(" ");return{height:t,left:u,top:c,transform:g,WebkitTransform:g,transitionDuration:m,width:s}}var h=function(e){var t=e.height,n=e.innerHeight,o=e.innerWidth,r=e.width,i=e.zoomMargin,a=o/(r+i),l=n/(t+i);return Math.min(a,l)}({height:t,innerWidth:r,innerHeight:o,width:s,zoomMargin:v}),E=(r/2-(u+s/2))/h,p=(o/2-(c+t/2))/h,b=n.__spreadArray(["scale(".concat(h,")"),"translate(".concat(E,"px, ").concat(p,"px)")],d?[d]:[],!0).join(" ");return{height:t,left:u,top:c,transform:b,WebkitTransform:b,transitionDuration:m,width:s}},d=function(e){var t=e.isLoaded,n=e.isUnloading,o=e.overlayBgColorEnd,r=e.overlayBgColorStart,i=e.transitionDuration,a=e.zoomZindex,u={backgroundColor:r,transitionDuration:l(i),zIndex:a};return t&&!n&&(u.backgroundColor=o),u},c={getBoundingClientRect:function(){return{height:0,left:0,top:0,width:0}},style:{transform:null}},f=e.memo((function(n){var o=n.children,i=n.closeText,l=void 0===i?"Unzoom Image":i,f=n.onUnload,s=n.onLoad,v=n.overlayBgColorEnd,m=void 0===v?"rgba(255, 255, 255, 0.95)":v,g=n.overlayBgColorStart,h=void 0===g?"rgba(255, 255, 255, 0)":g,E=n.parentRef,p=n.portalEl,b=void 0===p?document.body:p,y=n.scrollableEl,w=void 0===y?window:y,C=n.transitionDuration,z=void 0===C?300:C,k=n.zoomMargin,S=void 0===k?0:k,x=n.zoomZindex,B=void 0===x?2147483647:x,L=e.useRef(null),D=e.useState(0)[1],T=e.useState(!1),Z=T[0],R=T[1],M=e.useState(!1),U=M[0],W=M[1],A=a(),H=A.width,_=A.height,q=e.useCallback((function(e){e.preventDefault(),W(!0)}),[]),P=e.useCallback((function(e){"Escape"!==e.key&&27!==e.keyCode||(e.stopPropagation(),W(!0))}),[]),j=e.useCallback((function(){D((function(e){return e+1})),U||W(!0)}),[U]);e.useEffect((function(){return document.addEventListener("keydown",P),function(){document.removeEventListener("keydown",P)}}),[P]),e.useEffect((function(){var e;return null===(e=null==w?void 0:w.addEventListener)||void 0===e||e.call(w,"scroll",j),function(){var e;null===(e=null==w?void 0:w.removeEventListener)||void 0===e||e.call(w,"scroll",j)}}),[j,w]),e.useEffect((function(){R(!0),s(),L.current&&L.current.focus({preventScroll:!0})}),[s]),e.useEffect((function(){var e=U?setTimeout(f,z):null;return function(){e&&clearTimeout(e)}}),[U,f,z]);var F=E.current||c,I=F.getBoundingClientRect(),O=I.height,G=I.left,J=I.top,K=I.width,N=d({isLoaded:Z,isUnloading:U,overlayBgColorEnd:m,overlayBgColorStart:h,transitionDuration:z,zoomZindex:B}),Q=u({height:O,isLoaded:Z,innerHeight:_,innerWidth:H,isUnloading:U,left:G,originalTransform:F.style.transform,top:J,transitionDuration:z,width:K,zoomMargin:S});return t.createPortal(r.default.createElement("div",{"aria-label":"Zoomed image","aria-modal":!0,"data-rmiz-overlay":!0,role:"dialog",style:N},r.default.createElement("div",{"data-rmiz-modal-content":!0,style:Q},o),r.default.createElement("button",{"aria-label":l,"data-rmiz-btn-close":!0,onClick:q,ref:L})),b)})),s=e.memo((function(t){var n=t.children,o=t.closeText,i=void 0===o?"Unzoom image":o,a=t.overlayBgColorEnd,l=void 0===a?"rgba(255, 255, 255, 0.95)":a,u=t.overlayBgColorStart,d=void 0===u?"rgba(255, 255, 255, 0)":u,c=t.portalEl,s=t.openText,v=void 0===s?"Zoom image":s,m=t.scrollableEl,g=t.transitionDuration,h=void 0===g?300:g,E=t.wrapElement,p=void 0===E?"div":E,b=t.wrapStyle,y=t.zoomMargin,w=void 0===y?0:y,C=t.zoomZindex,z=void 0===C?2147483647:C,k=e.useState(!1),S=k[0],x=k[1],B=e.useState(!1),L=B[0],D=B[1],T=e.useRef(null),Z=e.useRef(null),R=e.useCallback((function(e){S||(e.preventDefault(),x(!0))}),[S]),M=e.useCallback((function(){D(!0)}),[]),U=e.useCallback((function(){x(!1),D(!1),Z.current&&Z.current.focus({preventScroll:!0})}),[]),W=S&&L?"hidden":"visible";return r.default.createElement(e.StrictMode,null,r.default.createElement(p,{"data-rmiz-wrap":W,ref:T,style:b},n,r.default.createElement("button",{"aria-label":v,"data-rmiz-btn-open":!0,onClick:R,ref:Z}),"undefined"!=typeof window&&S&&r.default.createElement(f,{closeText:i,onLoad:M,onUnload:U,overlayBgColorEnd:l,overlayBgColorStart:d,parentRef:T,portalEl:c,scrollableEl:m,transitionDuration:h,zoomMargin:w,zoomZindex:z},n)))}));function v(t){var n=e.useRef();return e.useEffect((function(){n.current=t})),n.current}var m=e.memo((function(n){var o=n.children,i=n.closeText,l=void 0===i?"Unzoom Image":i,f=n.isActive,s=n.onLoad,m=n.onUnload,g=n.onZoomChange,h=n.overlayBgColorEnd,E=void 0===h?"rgba(255, 255, 255, 0.95)":h,p=n.overlayBgColorStart,b=void 0===p?"rgba(255, 255, 255, 0)":p,y=n.parentRef,w=n.portalEl,C=void 0===w?document.body:w,z=n.scrollableEl,k=void 0===z?window:z,S=n.transitionDuration,x=void 0===S?300:S,B=n.zoomMargin,L=void 0===B?0:B,D=n.zoomZindex,T=void 0===D?2147483647:D,Z=e.useRef(null),R=e.useState(0)[1],M=e.useState(f),U=M[0],W=M[1],A=e.useState(!1),H=A[0],_=A[1],q=e.useState(!1),P=q[0],j=q[1],F=v(U),I=v(f),O=v(H),G=a(),J=G.width,K=G.height,N=e.useCallback((function(e){e.preventDefault(),g&&g(!1)}),[g]),Q=e.useCallback((function(e){!U||"Escape"!==e.key&&27!==e.keyCode||(e.stopPropagation(),g&&g(!1))}),[U,g]),V=e.useCallback((function(){R((function(e){return e+1})),!P&&g&&g(!1)}),[P,g]);e.useEffect((function(){return document.addEventListener("keydown",Q),function(){document.removeEventListener("keydown",Q)}}),[Q]),e.useEffect((function(){var e;return null===(e=null==k?void 0:k.addEventListener)||void 0===e||e.call(k,"scroll",V),function(){var e;null===(e=null==k?void 0:k.removeEventListener)||void 0===e||e.call(k,"scroll",V)}}),[V,k]),e.useEffect((function(){!F&&U&&(_(!0),Z.current&&Z.current.focus({preventScroll:!0}))}),[U,F]),e.useEffect((function(){I&&!f&&j(!0),!I&&f&&W(!0)}),[f,I]),e.useEffect((function(){var e;return P&&(e=setTimeout((function(){_(!1),W(!1),j(!1)}),x)),function(){clearTimeout(e)}}),[P,x]),e.useEffect((function(){!O&&H&&s(),O&&!H&&m()}),[H,s,m,O]);var X=y.current||c,Y=X.getBoundingClientRect(),$=Y.height,ee=Y.left,te=Y.top,ne=Y.width,oe=d({isLoaded:H,isUnloading:P,overlayBgColorEnd:E,overlayBgColorStart:b,transitionDuration:x,zoomZindex:T}),re=u({height:$,isLoaded:H,innerHeight:K,innerWidth:J,isUnloading:P,left:ee,originalTransform:X.style.transform,top:te,transitionDuration:x,width:ne,zoomMargin:L});return U?t.createPortal(r.default.createElement("div",{"aria-label":"Zoomed image","aria-modal":!0,"data-rmiz-overlay":!0,role:"dialog",style:oe},r.default.createElement("div",{"data-rmiz-modal-content":!0,style:re},o),r.default.createElement("button",{"aria-label":l,"data-rmiz-btn-close":!0,onClick:N,ref:Z,type:"button"})),C):null})),g=e.memo((function(t){var n=t.children,o=t.closeText,i=void 0===o?"Unzoom image":o,a=t.isZoomed,l=t.overlayBgColorEnd,u=void 0===l?"rgba(255, 255, 255, 0.95)":l,d=t.overlayBgColorStart,c=void 0===d?"rgba(255, 255, 255, 0)":d,f=t.portalEl,s=t.onZoomChange,v=t.openText,g=void 0===v?"Zoom image":v,h=t.scrollableEl,E=t.transitionDuration,p=void 0===E?300:E,b=t.wrapElement,y=void 0===b?"div":b,w=t.wrapStyle,C=t.zoomMargin,z=void 0===C?0:C,k=t.zoomZindex,S=void 0===k?2147483647:k,x=e.useState(!1),B=x[0],L=x[1],D=e.useRef(null),T=e.useRef(null),Z=e.useCallback((function(e){!a&&s&&(e.preventDefault(),s(!0))}),[a,s]),R=e.useCallback((function(){L(!0)}),[]),M=e.useCallback((function(){L(!1),T.current&&T.current.focus({preventScroll:!0})}),[]),U=B?"hidden":"visible";return r.default.createElement(e.StrictMode,null,r.default.createElement(y,{"data-rmiz-wrap":U,ref:D,style:w},n,r.default.createElement("button",{"aria-label":g,"data-rmiz-btn-open":!0,onClick:Z,ref:T,type:"button"}),"undefined"!=typeof window&&r.default.createElement(m,{closeText:i,isActive:a,onLoad:R,onUnload:M,onZoomChange:s,overlayBgColorEnd:u,overlayBgColorStart:c,parentRef:D,portalEl:f,scrollableEl:h,transitionDuration:p,zoomMargin:z,zoomZindex:S},n)))}));exports.Controlled=g,exports.default=s;
